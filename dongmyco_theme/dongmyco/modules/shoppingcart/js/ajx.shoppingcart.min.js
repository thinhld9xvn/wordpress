!function(a){var b=[],c=[],d={updateCart:!1,newCart:!1,removeCart:!1,updateSalesContentCarts:!1,disableAllFlags:function(){this.updateCart=!1,this.newCart=!1,this.removeCart=!1,this.updateSalesContentCarts=!1},setEnableFlag:function(a){this.disableAllFlags(),d[a]=!0},setDisableFlag:function(a){d[a]=!1}},e={},f={language:{decimal:",",thousands:".",lengthMenu:"Hi\u1ec3n th\u1ecb _MENU_ k\u1ebft qu\u1ea3",zeroRecords:"Ch\u01b0a c\xf3 s\u1ea3n ph\u1ea9m n\xe0o trong gi\u1ecf h\xe0ng.",info:"Trang _PAGE_ / _PAGES_",infoEmpty:"Kh\xf4ng c\xf3 s\u1ea3n ph\u1ea9m n\xe0o",infoFiltered:"",search:"T\xecm s\u1ea3n ph\u1ea9m ",paginate:{first:"Trang \u0111\u1ea7u",previous:"Tr\u01b0\u1edbc",next:"Sau",last:"Trang cu\u1ed1i"}},pageLength:25},g={language:{decimal:",",thousands:".",lengthMenu:"Hi\u1ec3n th\u1ecb _MENU_ k\u1ebft qu\u1ea3",zeroRecords:"Kh\xf4ng t\xecm th\u1ea5y k\u1ebft qu\u1ea3 n\xe0o",info:"Trang _PAGE_ / _PAGES_",infoEmpty:"Kh\xf4ng c\xf3 b\u1ea3n ghi n\xe0o",infoFiltered:"",search:"T\xecm s\u1ea3n ph\u1ea9m ",paginate:{first:"Trang \u0111\u1ea7u",previous:"Tr\u01b0\u1edbc",next:"Sau",last:"Trang cu\u1ed1i"}},pageLength:25},h=[];a.each(jshoppingcart,function(a,b){b.getTotal=function(){return parseInt(this.price)*parseInt(this.quantity)}}),jshoppingcart.getTotal=function(){var b=0;return a.each(this,function(){b+=this.getTotal()}),b};var i={updateScToServer:function(b){a("#UpdatingCartToServerModal").modal({show:!0,keyboard:!1,backdrop:"static"});var c={action:"sb_shoppingcart_ajax",cmd:"update_carts",carts:JSON.stringify(jshoppingcart)};a.post(sb_admin_ajax.url,c).done(function(c){"success"===c&&(a("#UpdatingCartToServerModal").modal("hide"),b())}).fail(function(){alert("L\u1ed7i ph\xe1t sinh trong qu\xe1 tr\xecnh g\u1eedi, xin h\xe3y th\u1eed l\u1ea1i sau !")})},updateSCartRTime:function(){var b=a(".jshopcartlist").find("table"),c=function(){var b=a(".shoppingcart").find(".numcart");b.text(jshoppingcart.length)},f=function(a){var d='<tr class="p'+a.index+'">   <td class="name">'+a.name+'</td>   <td class="quantity">'+a.quantity+"</td></tr>";i(),b.find("tbody").append(d),c()},g=function(a){b.find("tbody").find("tr.p"+a.index).find("td.quantity").text(a.quantity)},h=function(a){var d=b.find("tbody");d.find("tr.p"+a.index).remove(),0===d.find("tr:not(.empty)").length&&j(),c()},i=function(){b.hasClass("--hasCart")||b.addClass("--hasCart")},j=function(){b.hasClass("--hasCart")&&b.removeClass("--hasCart")},k=function(){a(".totalPriceCarts").text(currency.formatMoney(jshoppingcart.getTotal(),0,".",","))},l=function(b){var c=a('.pvcf-field[name="txtNoiDungDatHang"]');if(jshoppingcart.length>0){if(c.length>0){var d=c.val();if(""===d)a.each(jshoppingcart,function(a,b){d+=b.name+" ("+b.quantity+")\n"}),c.val(d);else if(void 0!==b){var e=d.indexOf(b.name);-1!==e&&(d=d.replace(new RegExp(b.name+" \\(\\d+\\)","g"),b.name+" ("+b.quantity+")"),c.val(d))}}}else{var f=a(".shoppingcart-customdisplay");f.length>0&&(c.val(""),f.addClass("hidden"))}},m=function(){d.newCart?(f(e),d.setDisableFlag("newCart"),k(),l(e)):d.updateCart?(g(e),d.setDisableFlag("updateCart"),k(),l(e)):d.removeCart?(h(e),d.setDisableFlag("removeCart"),k(),l(e)):d.updateSalesContentCarts&&(l(e),d.setDisableFlag("updateSalesContentCarts"))};setInterval(m,200)},determineRowHasQty:function(a){for(var b=a,c=null,d=!1;!d;)if(c=b.find(".quantity"),c.length>0)d=!0;else{if(!b.hasClass("child"))return!1;b=b.prev()}return b},doAddCart:function(b,c){var f=!1;e=b,a.each(jshoppingcart,function(a,c){c.name===b.name&&(c.quantity=b.quantity,d.setEnableFlag("updateCart"),f=!0)}),f||(jshoppingcart.push(b),d.setEnableFlag("newCart")),i.updateScToServer(c)},addToCart:function(b){var c=0,d=null,e=a(this).closest("tr"),f="";e=i.determineRowHasQty(e),f=e.find(".quantity").val(),e.hasClass("child")&&(e=e.prev()),c=e.index('tbody tr[role="row"]'),d=h[c],""!==f&&parseInt(f)>0?(d.quantity+=parseInt(f),i.doAddCart(d,function(){a("#AddToCartSuccessModal").modal({show:!0,keyboard:!1,backdrop:"static"})})):alert("M\u1eddi nh\u1eadp s\u1ed1 l\u01b0\u1ee3ng s\u1ea3n ph\u1ea9m !")},updateCart:function(b){var f=a(this).closest("tr"),g=0,h=null,j="",k=function(a,b){jshoppingcart[a].quantity=b,c[0].cell(a,5).data(currency.formatMoney(jshoppingcart[a].getTotal(),0,".",",")).draw(),e=jshoppingcart[a],d.setEnableFlag("updateCart"),i.updateScToServer(function(){})};switch(f=i.determineRowHasQty(f),g=f.index('tbody tr[role="row"]'),b.type){case"keyup":13===b.which&&(j=a(this).val(),""!==j&&parseInt(j)>0?k(g,j):(alert("M\u1eddi nh\u1eadp s\u1ed1 l\u01b0\u1ee3ng s\u1ea3n ph\u1ea9m !"),a(this).val(jshoppingcart[index].quantity)),a(this).blur());break;default:h=f.find(".quantity"),j=h.val(),""!==j&&parseInt(j)>0?k(g,j):(alert("M\u1eddi nh\u1eadp s\u1ed1 l\u01b0\u1ee3ng s\u1ea3n ph\u1ea9m !"),h.val(jshoppingcart[g].quantity))}},removeCart:function(b){var f=a(this).closest("tr"),g=0,h=a(this).closest("table").index(".dataTable");f=i.determineRowHasQty(f),g=f.index('tbody tr[role="row"]'),console.log(g),e=jshoppingcart[g],c[h].row(g).remove().draw(),jshoppingcart.splice(g,1),d.setEnableFlag("removeCart"),i.updateScToServer(function(){})}};i.updateSCartRTime(),a(document).on("click",".dataTable .btnAddToCart",i.addToCart),a(document).on("keyup",".dataTable.shoppingcart .quantity",i.updateCart),a(document).on("click",".dataTable .btnUpdateCart",i.updateCart),a(document).on("click",".dataTable .btnRemoveCart",i.removeCart),a('*[data-navig="jtablecart"]').each(function(){var c=a(this).find("table");c.each(function(c,d){var e=a(this).find("tbody"),f=e.find("tr:first-child"),i=null,j=null,k=null;a(this).removeAttr("width").removeAttr("style").prepend("<thead></thead>"),a(this).find("colgroup").remove(),a(this).find("tr").removeAttr("class").removeAttr("style"),a(this).find("td").removeAttr("class").removeAttr("width").removeAttr("height").removeAttr("style"),a(this).find("th").removeAttr("class").removeAttr("width").removeAttr("height").removeAttr("style"),k=a(this).find("thead"),f.append("<td>S\u1ed1 l\u01b0\u1ee3ng</td>").append("<td>Ch\u1ee9c n\u0103ng</td>"),i=f.find("td"),i.each(function(){a("<th>"+a(this).html()+"</th>").replaceAll(a(this))}),f.appendTo(k),j=e.find("tr"),j.each(function(){var b=a(this).index(),c={index:b,name:a(this).find("td:first-child").text().trim(),spec:"Chi\u1ec1u d\u1ea7y: "+a(this).find("td:nth-child(4)").text().trim()+" ("+a(this).find("td:nth-child(5)").text().trim()+")",price:currency.toPrice(a(this).find("td:last-child").text().trim(),"\\.",""),quantity:0,getTotal:function(){return parseInt(this.price)*parseInt(this.quantity)}};h[b]=c,a(this).append('<td><input style="width: 60px" class="form-control quantity" type="number" min="1" name="quantity" value="1" /></td>').append('<td><input class="btn btn-success btnAddToCart" type="button" data-index="'+b+'" value="Th\xeam gi\u1ecf h\xe0ng" /></td>')}),a(this).hasClass("display responsive nowrap")||a(this).addClass("display responsive nowrap"),b[c]=a(this).DataTable(g),a(this).removeAttr("style").closest(".sp-table").addClass("active")})}),a('*[data-navig="jmyscart"]').each(function(b,e){c[b]=a(this).DataTable(f),d.setEnableFlag("updateSalesContentCarts")})}(jQuery);