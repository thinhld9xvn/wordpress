jQuery(function(e){var t={accordion_index:0,ready:function(){var a=e(".metabox_groupbox_fields_sortables");a.sortable({connectWith:".metabox-field-postbox-item",handle:".metabox-handle-title",placeholder:"metabox-placeholder ui-corner-all"});var i=e(".metabox-accordion-sortables");i.sortable({connectWith:".metabox-field-postbox-item",handle:".metabox-handle-title",placeholder:"metabox-placeholder ui-corner-all"});try{this.accordion_index=accordion_index}catch(e){}i.on("sortupdate",this.on_accordion_sortupdate),i.each(function(a,i){var o=e(i).find(".accordion-template-item").find(".metabox-accordion-title").find(".title").attr("data-accordion-title-field");e(document).on("keyup",'input[type=text][id*="'+o+'"]',t.on_accordion_field_title_keyup)}),e(document).on("click",".metabox-collapse-box",this.on_collapse_field_box).on("click",".metabox-accordion-remove-button",this.on_accordion_remove_field).on("click",".metabox-handle-title, .metabox-collapse-button",this.on_accordion_handle_click),e(".metabox-accordion-add-button").click(this.on_accordion_add_field)},on_accordion_sortupdate:function(t,a){var i=0,o="",d="",n=null;e(".metabox-accordion-item:not(.accordion-template-item)").each(function(){n=e(this).find("*[name]"),n.each(function(){o=e(this).attr("id"),d=e(this).attr("name");var t=d.split(/\[\d\]/),a="",n="";2===t.length&&(a=t[0],n=t[1],n=n.replace("[","\\["),n=n.replace("]","\\]"),d=d.replace(new RegExp(a+"\\[\\d\\]"+n,"ig"),a+"["+i+"]"+n),d=d.replace(/\\/gi,""),e(this).attr("name",d),t=o.split(/-\d-/),a=t[0],n=t[1],o=o.replace(new RegExp(a+"-\\d-"+n,"ig"),a+"-"+i+"-"+n),e(this).attr("id",o))}),i++})},on_collapse_field_box:function(t){var a=e(this).closest(".metabox-field-postbox-item");a.siblings().filter(function(t){return!e(this).hasClass("closed")}).addClass("closed"),a.toggleClass("closed")},on_accordion_add_field:function(a){var i=e(this).next(".metabox-accordion-group"),o=i.find(".accordion-template-item").clone();o.removeClass("accordion-template-item"),e(this).next(".metabox-accordion-sortables").sortable("refresh"),o.find('*[id*="-uo-"], *[name*="-uo-"]').each(function(a,i){var o=e(i),d=o.attr("id"),n=o.attr("name");void 0!==d&&(o.is("textarea")&&o.hasClass("wp-editor-area")&&o.data("editor-old-id",d),d=d.replace(new RegExp("-uo-","ig"),""),d=d.replace(new RegExp("-uc-","ig"),""),d=d.replace(new RegExp("__index__","ig"),t.accordion_index),o.attr("id",d)),void 0!==n&&(n=n.replace(new RegExp("-uo-","ig"),"["),n=n.replace(new RegExp("-__index__-","ig"),t.accordion_index),n=n.replace(new RegExp("-uc-","ig"),"]"),e(i).attr("name",n))}),o.removeClass("closed").appendTo(i);var d=o.find(".wp-editor-wrap").find("textarea");d.each(function(t,a){var i=e(a),o=i.closest(".wp-editor-container"),d=o.prev(".wp-editor-tools"),n=d.find("button.add_media"),l=d.find("button.wp-switch-editor"),s=i.attr("id"),c=i.data("editor-old-id"),r=i.attr("name");i.prev(".mce-container").remove(),i.prev(".quicktags-toolbar").remove(),i.remove(),n.attr("data-editor",s),l.attr("data-wp-editor-id",s),o.append("<textarea class='wp-editor-area' rows='5' tabindex='1' autocomplete='off' cols='40' id='"+s+"' name='"+r+"'></textarea>");var m=tinyMCEPreInit.mceInit[c];m.selector="#"+s,tinymce.init(m);var h=quicktags({id:s}),p=setInterval(function(){"object"==typeof h&&(QTags._buttonsInit(),d.find(".wp-switch-editor.switch-html").click(),clearInterval(p))},200)}),t.accordion_index++},on_accordion_remove_field:function(a){var i=e(this).closest(".metabox-accordion-item");i.find("textarea[class='wp-editor-area']").each(function(t,a){tinymce.get(e(a).attr("id")).remove()}),i.remove(),t.accordion_index--},on_accordion_field_title_keyup:function(t){var a=e(this).closest(".metabox-accordion-item"),i=a.find(".metabox-accordion-title").find(".title"),o=e(this).val();""!==o?i.html(" : "+o):i.html("")},on_accordion_handle_click:function(t){var a=e(this);e(this).hasClass("metabox-collapse-button")&&(a=e(this).next("h2.metabox-handle-title"));var i=a.closest(".metabox-field-postbox-item");if(i.closest(".metabox-field-postbox-item").siblings().find("h2.metabox-handle-title").removeClass("markup"),a.hasClass("markup")||a.addClass("markup"),i.hasClass("closed")){var o=i.find(".metabox-field-postbox-item");o.length>0&&(o.find("h2.metabox-handle-title").removeClass("markup"),o.addClass("closed"))}}},a={ready:function(){e("form").on("submit",function(t){if("undefined"!=typeof tinyMCE&&($wp_editors=tinyMCE.editors,$wp_editors.length>0)){e(".wp-switch-editor.switch-tmce").click();for(var a=0;a<$wp_editors.length;a++){var i=$wp_editors[a].id,o=e("#"+i+"-editor"),d="";o.length>0&&($wp_editors[a].save(),d=$wp_editors[a].getContent(),o.val(d))}}})}},i={ready:function(){function t(e,t,a,i,o){switch(i){case"=":t===a?e.hasClass("mb_hidden")&&e.removeClass("mb_hidden"):e.hasClass("mb_hidden")||e.addClass("mb_hidden");break;case"!=":t!==a?e.hasClass("mb_hidden")&&e.removeClass("mb_hidden"):e.hasClass("mb_hidden")||e.addClass("mb_hidden")}}function a(t,a,i,o,d,n){for(var l=i.length,s=null,c=0;c<l;c++){var r=i[c],m=e("#"+r).val(),h=o[c],p=d[c],f=!0;switch(p){case"=":f=m===h;break;case"!=":f=m!==h}switch(n){case"AND":s=null===s?f:s&&f;break;case"OR":s=null===s?f:s||f}}s?t.hasClass("mb_hidden")&&t.removeClass("mb_hidden"):t.hasClass("mb_hidden")||t.addClass("mb_hidden"),t.data("condition-complex-approved","approved")}function i(i,o,d){var n=e("#advanced-sortables").find(".metabox_wrap"),l=function(i,n){var l=e(n),s=!1,c=l.attr("data-metabox-condition-complex"),r=l.attr("data-metabox-condition-rule"),m=l.attr("data-metabox-condition-field"),h=l.attr("data-metabox-condition-value"),p=l.attr("data-metabox-condition-compare"),f=l.attr("data-metabox-condition-operator"),u=!0;if(l.hasClass("metabox_wrap")&&(l=l.closest(".postbox"),s=!0),"visible"===r)if("true"===c){if("each"===d&&"approved"===l.data("condition-complex-approved")&&(u=!1),u){var _=m.split(","),b=h.split(","),v=p.split(",");a(l,o,_,b,v,f)}}else t(l,o,h,p,s)},s=n.filter('div[data-metabox-condition-field="'+i+'"]');s.length>0&&s.each(l);var c=n.find('div[data-metabox-condition-field*="'+i+'"]');c.length>0&&c.each(l)}function o(t){var a=t.val();(t.hasClass("slFrontTermLayout")||t.hasClass("slTermLayout"))&&e(".form_table_layout").each(function(t,i){e(i).hasClass(a)?e(i).hasClass("mb_hidden")&&e(i).removeClass("mb_hidden"):e(i).hasClass("mb_hidden")||e(i).addClass("mb_hidden")})}var d=e(".select_field_metabox");d.change(function(t){var a=e(this),d=a.val();a.hasClass("validate")?i(a.attr("id"),d,"change"):o(a)}),d.each(function(t,a){var d=e(a);d.hasClass("validate")?i(d.attr("id"),d.val(),"each"):o(d)})}},o={ready:function(){e(document).on("click",".field_media_widget_remove",this.removeCustomFieldMedia).on("click",".media_upload",this.uploadMedia).on("click",".field_media_widget_add",this.addCustomFieldMedia)},addCustomFieldMedia:function(t){t.preventDefault();var a=e(this).attr("data-field-id"),i=e(this).attr("data-image-path"),o=i+"/widget_remove.png",d="true"===e(this).attr("data-thumbnail-enable"),n="";n+='<div class="field mtop10">',d&&(n+='<img src="" class="thumbnail_media_field_metabox vmiddle" />'),n+='    <input type="text" name="'+a+'[]" class="media_field_metabox vmiddle" value="" />    <input type="button" class="button button-default media_upload vmiddle" value="Chọn ảnh" />    <img src="'+o+'" class="field_media_widget_remove vmiddle cpointer" /></div>',e(this).closest(".metabox_field").append(n)},removeCustomFieldMedia:function(t){t.preventDefault(),e(this).closest(".field").remove()},uploadMedia:function(t){t.preventDefault();var a=e(this).closest(".field"),i=a.find(".thumbnail_media_field_metabox"),o=a.find(".media_field_metabox"),d=wp.media({title:"Select Media",button:{text:"Upload Image"},multiple:!1}).on("select",function(){var e=d.state().get("selection").first().toJSON();i.length>0&&i.attr("src",e.url),o.val(e.url)}).open()}},d={ready:function(){var t=e(".txtFTypical"),a=t.filter(".tFChange");a.length>0&&a.change(function(t){var a=e(this).val();e(this).is(":checkbox")&&(a=e(this).prop("checked")),e(this).next().val(a)})}};t.ready(),a.ready(),i.ready(),o.ready(),d.ready()});